<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="extensions/filter-control/bootstrap-table-filter-control.css">
    <link href="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link href="https://s3-us-west-2.amazonaws.com/colors-css/2.2.0/colors.min.css" rel="stylesheet">

</head>
<style>
    .nav {
        background-color: #007d8f !important;
    }

    .btnTab {
        background-color: #007d8f !important;
        border: #64c5e4;
    }

    .thead {
        background-color: #ffffff !important
    }

    .table-bordered td,
    .table-bordered th {
        border: 1px solid #ffffff;
    }

    .dropdown-item.active,
    .dropdown-item:active {
        color: #ffc107;
        text-decoration: none;
        background-color: #ffffff;
    }

    .load {
        display: none;
    }

    .bootstrap-table .fixed-table-container .table thead th {
        vertical-align: bottom;
        padding: 10px;
    }
</style>

<body>

    <nav class=" nav navbar text-white px-5 d-flex ">
        <div class="row">
            <img src="https://drive.google.com/thumbnail?id=1K9MzSj7PdjqcZN33VMMBfioNacbS7Wfs" width="106" height="44">
            <p class="navbar-brand">
                SmartServices Liste des événements
            </p>
        </div>
        <div class="">
            <svg width="2em" height="2em" viewBox="0 0 16 16" class="navbar-brand bi bi-envelope-fill text-white"
                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                    d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z" />
            </svg>
            <p class="navbar-brand">
                <?=urlemail?>
            </p>
        </div>
    </nav>
    <div class="container-fluid px-3">

        <form>

            <div id="toolbar">
                <?if(Admin == 'true' ){?>
                <div class="row">
                    <button class="btn btn-warning  text-white mx-2">Exporter</button>
                    <div class="load spinner-border text-warning mx-2" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>
                <?
          }else{
          }?>

            </div>
            <table class="table" id="table" data-toolbar="#toolbar" data-toggle="table" data-search="true"
                data-pagination="true" data-pagination-v-align="both" data-toolbar=".btn-outline-warning"
                data-id-field="idevent" data-select-item-name="idevent" data-filter-control="true"
                data-show-search-clear-button="true">
                <thead class=" thead  text-secondary">
                    <tr>
                        <?if(Admin == 'true' ){?>

                        <th data-checkbox="true"></th>
                        <th data-sortable="true" data-field="export">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check2-square"
                                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                    d="M15.354 2.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L8 9.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
                                <path fill-rule="evenodd"
                                    d="M1.5 13A1.5 1.5 0 0 0 3 14.5h10a1.5 1.5 0 0 0 1.5-1.5V8a.5.5 0 0 0-1 0v5a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V3a.5.5 0 0 1 .5-.5h8a.5.5 0 0 0 0-1H3A1.5 1.5 0 0 0 1.5 3v10z" />
                            </svg>
                        </th>
                        <th data-sortable="true">⚠</th>
                        <th data-sortable="true">❌</th>
                        <?
                            }else{
                            }?>
                        <th data-visible="false" data-sortable="true" data-field="idevent">Idevent</th>
                        <?if(Admin == 'true'){?>
                        <th data-sortable="true" data-field="Email" data-filter-control="select">Email</th>
                        <?}else{}?>
                        <th data-sortable="true" data-field="nomSalle" data-filter-control="select">Nom Salle</th>
                        <th data-sortable="true" data-field="Libelle">Libelle</th>
                        <th data-sortable="true" data-field="Organisateur">Organisateur</th>
                        <th data-sortable="true" data-field="received" data-filter-control="datepicker"
                            data-filter-datepicker-options='{"autoclose":true, "clearBtn": true, "todayHighlight": true, "orientation": "top", "format":"dd/mm/yyyy"}'>
                            Date</th>

                        <th>Heure</th>
                        <th data-sortable="true" data-field="services" data-filter-control="select"
                            data-cell-style="cellStyle">Services</th>
                        <?if(Admin == 'true'){?>
                        <th data-sortable="true" data-field="demandeComplexe" data-filter-control="select">Demande</th>
                        <?}else{}?>
                        <th>Modifier</th>
                    </tr>
                </thead>

                <tbody>
                    <? for(i=0;i<listeFormshtml.length;i++){?>
                    <? if(listeFormshtml[i][12] == 'Valid' || Admin == 'true'){?>
                    <tr <? if( Utilities.formatDate(new Date(), "GMT" , "dd/MM/yyyy" )===Utilities.formatDate(new
                        Date(listeFormshtml[i][2]), "GMT" , "dd/MM/yyyy" ) && Utilities.formatDate(new Date(), "GMT"
                        , "dd/MM/yyyy" )===listeFormshtml[i][10]){?> class="table-success"
                        <?}else{}?>>
                        <?if(Admin == 'true'){?>
                        <td<?if(listeFormshtml[i][12]=='Valid' ){}else{?> disable
                            <?}?>></td>
                            <td>
                                <?if(listeFormshtml[i][9]){?>
                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check2-square"
                                    fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M15.354 2.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L8 9.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
                                    <path fill-rule="evenodd"
                                        d="M1.5 13A1.5 1.5 0 0 0 3 14.5h10a1.5 1.5 0 0 0 1.5-1.5V8a.5.5 0 0 0-1 0v5a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V3a.5.5 0 0 1 .5-.5h8a.5.5 0 0 0 0-1H3A1.5 1.5 0 0 0 1.5 3v10z" />
                                </svg>
                                <?}?>
                            </td>
                            <td>
                                <?if(listeFormshtml[i][14] && listeFormshtml[i][13] > listeFormshtml[i][14]){?>⚠️
                                <?}else{?>
                                <?}?>
                            </td>
                            <td>
                                <?if(listeFormshtml[i][12] == 'Valid'){}else{?>❌
                                <?}?>
                            </td>
                            <?
                            }else{
                            }?>
                            <td type="hidden">
                                <?=listeFormshtml[i][3]?>
                            </td>
                            <?if(Admin == 'true'){?>
                            <td>
                                <?=listeFormshtml[i][4]?>
                            </td>
                            <?}else{}?>
                            <td value="<?=listeFormshtml[i][3]?>">
                                <?=listeFormshtml[i][0]?>
                            </td>
                            <td>
                                <?=listeFormshtml[i][1]?>
                            </td>
                            <td>
                                <?=listeFormshtml[i][7]?>
                            </td>
                            <td>
                                <?=listeFormshtml[i][2]?>
                            </td>

                            <td>de
                                <?=listeFormshtml[i][5]?> a
                                <?=listeFormshtml[i][6]?>
                            </td>
                            <td>
                                <?=listeFormshtml[i][8]?>
                            </td>
                            <?if(Admin == 'true'){?>
                            <td>
                                <?=listeFormshtml[i][11]?>
                            </td>
                            <?}else{}?>
                            <td><a href="<?=URL?>?idevent=<?=listeFormshtml[i][3]?>&creator=<?=listeFormshtml[i][4]?>"
                                    style=" width: 8rem" id="btnModif" class="btnTab btn text-white">Modifier</a></td>
                    </tr>
                    <?}else{
                       }?>
                    <?}?>
                </tbody>
            </table>
        </form>
    </div>
    <script>
        var $table = $('#table')

        function cellStyle(value, row, index) {
            if (value == "Services réservés") {
                return {
                    css: {
                        background: '#28a745'
                    }
                }
            }
            else {
                return {
                    css: {
                        background: '#ffc107'
                    }
                }
            }
        }

        $(function () {
            $('form').submit(function () {

                $('.load').show();
                google.script.run.withSuccessHandler(onSuccess).ExportBaseDeCommande($(this).serializeArray());

                return false
            })
        })
        function onSuccess() {
            window.open("<?=URL?>?v=listeForms", "_top");
        }



    </script>

    <script src="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.16.0/dist/locale/bootstrap-table-fr-FR.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
    <script
        src="https://unpkg.com/bootstrap-table@1.18.0/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

</body>

</html>